{
  "title": "笔记一",
  "cells": [
    {
      "type": "text",
      "data": "<div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">1.1 背景&amp; JMS概述</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">当前RPC框架广泛应用于各个领域，当有局限性:</div><ol yne-block-type=\"list\"><li style=\"list-style-type: decimal; list-style-position: inside; white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00\">同步通信:</span></li><li style=\"list-style-type: decimal; list-style-position: inside; white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00\">客户和服务对象的生命周期紧密耦合</span></li><li style=\"list-style-type: decimal; list-style-position: inside; white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00\">点对点通信</span> </li></ol><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">面向消息的中间件较好的解决了以上问题:</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">这种模式下，<span style=\"background-color:#FFFF00\">发送和接收是异步的，发送者无需等待；</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00\">二者的生命周期未必相同</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00\">一对多通信</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-weight:bold\">1.2 JMS术语</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Provider:生产者</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Consumer:消费者</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">PTP:点对点消息模型</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Pub/Sub: 发布/订阅的消息模型</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Queue:队列目标</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Topic：主题目标</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">ConnectionFactory: 连接工厂,JMS用它创建连接</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Connect:JMS客户端到JMSProvider的连接</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Destination:消息的目的地</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">Session: 会话，一个发送或接收消息的线程</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00;font-weight:bold\">Session:</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">//3. 通过connection对象创建session会话(上下文环境)，用于接收消息，参数一：是否开启事物，参数二:签收模式 ，一般是默认签收</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">Session session = connection.createSession(Boolean.</span><span style=\"font-size:12px;color:#660e7a;background-color:#ffffff;font-weight:bold;font-style:italic\">TRUE</span><span style=\"font-size:12px;background-color:#ffffff\">, Session.</span><span style=\"font-size:12px;color:#660e7a;background-color:#ffffff;font-weight:bold;font-style:italic\">CLIENT_ACKNOWLEDGE</span><span style=\"font-size:12px;background-color:#ffffff\">);</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">开启事物  必须在 发送或者接收完消息后  commit()</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">客户端签收要 msg.acknowledge();</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00;font-weight:bold\">MessageProducer:</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">public void </span><span style=\"font-size:12px;background-color:#e4e4ff\">send</span><span style=\"font-size:12px;background-color:#ffffff\">(Destination destination, Message message, </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">int </span><span style=\"font-size:12px;background-color:#ffffff\">deliveryMode, </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">int </span><span style=\"font-size:12px;background-color:#ffffff\">priority, </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">long </span><span style=\"font-size:12px;background-color:#ffffff\">timeToLive) </span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">其中deliveryMode 为传送模式（持久和非持久，默认持久），</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">priority为消息优先级（0-9十个级别，0-4是普通消息，5-9是加急消息，默认为4）</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">timeTolive为消息过期时间（默认消息永不过期）</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"background-color:#FFFF00\">MessageConsumer:</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">MessageConsumer createConsumer(Destination destination, String messageSelector)</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">其中messageSelector为选择器: noLocal标志默认为false，当设置为true时限制消费者只能接收和自己相同的连接发布的消息，此标志只适用于主题，不适用于队列；name标识订阅主题所对应的订阅名称，持久订阅时需要设置此参数</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">public final String SELECTOR = \"JMS_TYPE = 'MY_TAG1' \";</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">注意： 使用selector 时   producer 设置消息时 要使用 *</span><span style=\"font-size:12px;background-color:#e4e4ff\">Property方法。</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">consumer 可以使用listener监听订阅订阅的消息</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">public class </span><span style=\"font-size:12px;background-color:#ffffff\">CustomerMQListener  </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">implements </span><span style=\"font-size:12px;background-color:#ffffff\">SessionAwareMessageListener&lt;Message&gt;{</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#808000;background-color:#ffffff\">@Autowired</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808000;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">private </span><span style=\"font-size:12px;background-color:#ffffff\">JmsTemplate </span><span style=\"font-size:12px;color:#660e7a;background-color:#ffffff;font-weight:bold\">jmsTemplate</span><span style=\"font-size:12px;background-color:#ffffff\">;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">public void </span><span style=\"font-size:12px;background-color:#ffffff\">onMessage(Message message, Session session) </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">throws </span><span style=\"font-size:12px;background-color:#ffffff\">JMSException {</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">        TextMessage tm = (TextMessage) message;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">        System.</span><span style=\"font-size:12px;color:#660e7a;background-color:#ffffff;font-weight:bold;font-style:italic\">out</span><span style=\"font-size:12px;background-color:#ffffff\">.println(tm);</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">        </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">try </span><span style=\"font-size:12px;background-color:#ffffff\">{</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">            System.</span><span style=\"font-size:12px;color:#660e7a;background-color:#ffffff;font-weight:bold;font-style:italic\">out</span><span style=\"font-size:12px;background-color:#ffffff\">.println(tm.getText());</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">        } </span><span style=\"font-size:12px;color:#000080;background-color:#ffffff;font-weight:bold\">catch </span><span style=\"font-size:12px;background-color:#ffffff\">(JMSException e) {</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">            e.printStackTrace();</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">        }</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    }</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">}</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">PTP/PS 指的是Destination 类型： PTP是 队列， PS是 TOPIC </div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\">与spring的整合</div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 配置JMS连接工厂 --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"consumerConnectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.apache.activemq.ActiveMQConnectionFactory\"</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"brokerURL\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"failover:(tcp://localhost:61616)\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"userName\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"amdin\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"password\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"amdin\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"useAsyncSend\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"true\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"clientID\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"providerClienctConnect\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!--</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">ActiveMQ 为我们提供了 一个 PooledConnectionFactory， 通过往里边注入一个ActiveMQConnectionFactory，</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">可以用来将Connect. Session  和 MessageProducter 池化， 这样可以大大的减少我们的资源消耗，要 依赖于 activemq-pool包</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">--&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"pooledConnectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.apache.activemq.pool.PooledConnectionFactory\"</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\"  </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"consumerConnectionFactory\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"maxConnections\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"1000\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- Spring 用于管理真正的 ConnectionFactory 的 ConnectionFactory--&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.springframework.jms.connection.SingleConnectionFactory\" </span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 目标ConnectionFactory 对应真实的可以产生JMS Connection的 ConnectionFactory --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"targetConnectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"pooledConnectionFactory\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 定义消息Destination --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"topicDestination\"  </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.apache.activemq.command.ActiveMQTopic\"</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!--&lt;constructor-arg value=\"testSpringTopic\"/&gt;--&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">constructor-arg </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"giveTopic\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">生产端：</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 消息发送者客户端 --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"jmsTemplate\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.springframework.jms.core.JmsTemplate\"</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"defaultDestination\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"topicDestination\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 开启订阅模式 --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"pubSubDomain\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"true\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- deliveryMode, priority, timeToLive 的开关要生效，必须配置为true，默认false--&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"explicitQosEnabled\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"true\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 发送模式</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">         DeliveryMode.NON_PERSISTENT=1:非持久 ;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">         DeliveryMode.PERSISTENT=2:持久</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">    --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"deliveryMode\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">value</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"2\"</span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">消费端：</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!--  配置自定义监听: MessageListener  --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"customerMQListener\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"com.demo.activemq.ps.CustomerMQListener\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 消息接收者客户端 --&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"jmsTemplate\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.springframework.jms.core.JmsTemplate\"</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"defaultDestination\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"topicDestination\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;color:#808080;background-color:#ffffff;font-style:italic\">&lt;!-- 将连接工厂， 目标主题 ,自定义监听注入jmsTemplate--&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">id</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"sessionAwareListenerContainer\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">class</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"org.springframework.jms.listener.DefaultMessageListenerContainer\"</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"connectionFactory\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"destination\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"topicDestination\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#ffffff\">    </span><span style=\"font-size:12px;background-color:#efefef\">&lt;</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">property </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">name</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"messageListener\" </span><span style=\"font-size:12px;color:#0000ff;background-color:#efefef;font-weight:bold\">ref</span><span style=\"font-size:12px;color:#008000;background-color:#efefef;font-weight:bold\">=\"customerMQListener\" </span><span style=\"font-size:12px;background-color:#efefef\">/&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><span style=\"font-size:12px;background-color:#efefef\">&lt;/</span><span style=\"font-size:12px;color:#000080;background-color:#efefef;font-weight:bold\">bean</span><span style=\"font-size:12px;background-color:#efefef\">&gt;</span></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div><div yne-bulb-block=\"paragraph\" style=\"white-space: pre-wrap; line-height: 1.5; font-size: 14px;\"><br></div>"
    }
  ]
}